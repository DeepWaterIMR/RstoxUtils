<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Download and Visualize Landings Data • RstoxUtils</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Download and Visualize Landings Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RstoxUtils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/BioticData.html">Biotic</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/LandingsData.html">Sales notes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/ERSdata.html">Electronic Reporting System</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/CodeDefinitions.html">Definitons</a></li>
    <li><hr class="dropdown-divider"></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DeepWaterIMR/RstoxUtils/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Download and Visualize Landings Data</h1>
                        <h4 data-toc-skip class="author">Mikko Vihtakari (Institute of Marine Research)</h4>
            
            <h4 data-toc-skip class="date">15 September, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DeepWaterIMR/RstoxUtils/blob/HEAD/vignettes/LandingsData.Rmd" class="external-link"><code>vignettes/LandingsData.Rmd</code></a></small>
      <div class="d-none name"><code>LandingsData.Rmd</code></div>
    </div>

    
    
<p>Packages required to run the examples:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Package names</span></span>
<span><span class="va">packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RstoxUtils"</span>, <span class="st">"sf"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggOceanMaps"</span>, <span class="st">"ggplot2"</span>, <span class="st">"data.table"</span>,</span>
<span>              <span class="st">"lubridate"</span>, <span class="st">"tidyr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install packages not yet installed</span></span>
<span><span class="va">installed_packages</span> <span class="op">&lt;-</span> <span class="va">packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">installed_packages</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="st">"RstoxUtils"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">packages</span><span class="op">[</span><span class="op">!</span><span class="va">installed_packages</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"DeepWaterIMR/RstoxUtils"</span>, upgrade <span class="op">=</span> <span class="st">"never"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">installed_packages</span> <span class="op">&lt;-</span> <span class="va">packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">packages</span><span class="op">[</span><span class="op">!</span><span class="va">installed_packages</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Load the packages to the workspace</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">packages</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">x</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Landings from Norwegian commercial fisheries are delivered to registered landing facilities, which include both fish processing plants and receiving stations. All landings must be documented through a sales note (sluttseddel), which records detailed information about the catch, including species composition, quantity, landing location, and fishing area. These sales notes constitute a primary data source for official catch statistics and are extensively used in fisheries management and stock assessments in Norway. Since there is a general landing obligation in Norway, the terms ‘landings’ and ‘catches’ are used interchangeably even though unrecorded disgards might occur. The data are distributed as .zip archives via the Norwegian Directorate of Fisheries (FDir) <a href="https://www.fiskeridir.no/statistikk-tall-og-analyse/data-og-statistikk-om-yrkesfiske/apne-data-fangstdata-seddel-koblet-med-fartoydata" class="external-link">website</a>, and are also accessible through the IMR API on the intranet. The API enables searching and filtering without downloading the entire dataset. The <code><a href="../reference/downloadLandings.html">downloadLandings()</a></code> function retrieves sales note data from the IMR API for the period from 2005 onward, while older data are available as Excel files on IMR servers and can be accessed using the <code><a href="../reference/readSluttseddelXLS.html">readSluttseddelXLS()</a></code> function. The <code><a href="../reference/downloadLandings.html">downloadLandings()</a></code> function require a connection to the IMR intranet, while <code><a href="../reference/readSluttseddelXLS.html">readSluttseddelXLS()</a></code> <code>dataDir</code> can be defined to access the data from anywhere (for example your hard disk if you have copied the data from the server).</p>
<div class="section level3">
<h3 id="download-sales-note-data-from-2005-onward">Download sales note data from 2005 onward<a class="anchor" aria-label="anchor" href="#download-sales-note-data-from-2005-onward"></a>
</h3>
<p>The <code><a href="../reference/downloadLandings.html">downloadLandings()</a></code> can be used to download sales note data utilizing the IMR API containing data from 2005. Specify the species name in Norwegian (see <code>FDIRcodes$speciesCodes</code> or Table 1 in the <a href="https://deepwaterimr.github.io/RstoxUtils/articles/CodeDefinitions.html">Codes and definitions</a> vignette) and years (if you do not want to download all data). In the example, we’ll download sales note data for beaked redfish (<em>Sebastes mentella</em>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/downloadLandings.html">downloadLandings</a></span><span class="op">(</span><span class="st">"Snabeluer"</span><span class="op">)</span></span></code></pre></div>
<p>The function returns a summary of the data by default that picks the relevant columns from the sales note list to calculate landings. For reference, the summary is a simple <a href="https://cran.r-project.org/package=dplyr" class="external-link"><em>dplyr</em></a> expression:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales_notes</span><span class="op">$</span><span class="va">Produkt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"Fangst\u00e5r"</span>, <span class="st">"SisteFangstdato"</span>, <span class="st">"Redskap_kode"</span>, <span class="st">"Hovedomr\u00e5de_kode"</span>,</span>
<span>    <span class="st">"Lokasjon_kode"</span>, <span class="st">"Fart\u00f8ynasjonalitet_kode"</span>, <span class="st">"Rundvekt"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"date"</span>, <span class="st">"gear_id"</span>, <span class="st">"main_area"</span>, <span class="st">"sub_area"</span>,</span>
<span>                    <span class="st">"nation"</span>, <span class="st">"weight"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date</span>, format <span class="op">=</span> <span class="st">"%d.%m.%Y"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">weight</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, .before <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">main_area</span>, <span class="va">sub_area</span>, <span class="va">gear_id</span><span class="op">)</span>, <span class="va">as.integer</span><span class="op">)</span></span></code></pre></div>
<p>This vignette does not delve deeper into the structure of sales notes. Once the download is finished, we take the summary element from the sales note list for further analysis:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salesnote_example_data</span> <span class="op">&lt;-</span> <span class="va">lnd</span><span class="op">$</span><span class="va">summary</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sales-note-data-figure-inspiration">Sales note data figure inspiration<a class="anchor" aria-label="anchor" href="#sales-note-data-figure-inspiration"></a>
</h3>
<p>Below are figures the package author uses in assessment reports. Please, feel free to reuse and modify. Thank the author, if you did so :)</p>
<p>Landings by nation and gear (Figure <a href="#fig:fig-gearOverview">1</a>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pnd</span> <span class="op">&lt;-</span> <span class="va">salesnote_example_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">nation</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">nation</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>nation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nation</span>, levels <span class="op">=</span> <span class="va">nation</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pn</span> <span class="op">&lt;-</span> <span class="va">pnd</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">nation</span>, y <span class="op">=</span> <span class="va">mean</span>, ymin <span class="op">=</span> <span class="va">mean</span>, ymax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbar</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Nation code"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Reported landings (kt ± SD)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu">sec_axis</span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">*</span><span class="fl">100</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pnd</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Percentage of total average landings"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y.right <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pgd</span> <span class="op">&lt;-</span> <span class="va">salesnote_example_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span></span>
<span>    <span class="va">FDIRcodes</span><span class="op">$</span><span class="va">gearCodes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span>gearCategory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"\n"</span>, <span class="va">gearCategory</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">gear_id</span> <span class="op">==</span> <span class="va">idGear</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gearCategory</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gearCategory</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>gear <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gearCategory</span>, levels <span class="op">=</span> <span class="va">gearCategory</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pg</span> <span class="op">&lt;-</span> <span class="va">pgd</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gear</span>, y <span class="op">=</span> <span class="va">mean</span>, ymin <span class="op">=</span> <span class="va">mean</span>, ymax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbar</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Gear category"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Reported landings (kt +/- SD)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu">sec_axis</span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">*</span><span class="fl">100</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pgd</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Percentage of total average landings"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y.left <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">pn</span>, <span class="va">pg</span>, labels <span class="op">=</span> <span class="st">"AUTO"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-gearOverview"></span>
<img src="LandingsData_files/figure-html/fig-gearOverview-1.png" alt="Average annual beaked redfish catches delivered to Norwegian landing facilities by nation (A) and catches by reported gear (B). Error bars indicate standard deviations among years. Catches in kilotons are shown on the left y-axis while the right y-axis indicates the percentage of total average landings." width="864"><p class="caption">
Figure 1: Average annual beaked redfish catches delivered to Norwegian landing facilities by nation (A) and catches by reported gear (B). Error bars indicate standard deviations among years. Catches in kilotons are shown on the left y-axis while the right y-axis indicates the percentage of total average landings.
</p>
</div>
<p>Geographic distribution of landings (Figure <a href="#fig:fig-percentageMap">2</a>). Note how vessels tend to fish outside Norwegian waters and still deliver the fish to Norwegian landing facilities. These landings must be filtered out when doing assessment for a specific region.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">salesnote_example_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">main_area</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">ggOceanMaps</span><span class="fu">::</span><span class="va"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/fdir_main_areas.html" class="external-link">fdir_main_areas</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>              <span class="fu">mutate</span><span class="op">(</span>main_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">main_area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggOceanMaps</span><span class="fu">::</span><span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/basemap.html" class="external-link">basemap</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_distiller</span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Spectral"</span>, na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Catch (kt)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">reorder_layers</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-percentageMap"></span>
<img src="LandingsData_files/figure-html/fig-percentageMap-1.png" alt="Spatial distribution of beaked redfish landed to Norwegian harbors by year." width="864"><p class="caption">
Figure 2: Spatial distribution of beaked redfish landed to Norwegian harbors by year.
</p>
</div>
<p>The most important figure, annual landings by Norwegian vessels in the assessment area, as international data are accessed through ICES (Figure <a href="#fig:fig-annual-landings">3</a>). According to the package author, the main areas (hovedområde) <code>c(0:7, 10:18, 20:27, 30, 34:39, 50)</code> roughly correspond to ICES areas 1 and 2 according to the package author. Please provide feedback, if this correspondence can be improved.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salesnote_example_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">main_area</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">18</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">27</span>, <span class="fl">30</span>, <span class="fl">34</span><span class="op">:</span><span class="fl">39</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>    <span class="va">nation</span> <span class="op">==</span> <span class="st">"NOR"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Catch (kt)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-annual-landings"></span>
<img src="LandingsData_files/figure-html/fig-annual-landings-1.png" alt="Annual beaked redfish landings by the Norwegian fleet within ICES areas 1 and 2 according to the sales note data." width="864"><p class="caption">
Figure 3: Annual beaked redfish landings by the Norwegian fleet within ICES areas 1 and 2 according to the sales note data.
</p>
</div>
</div>
<div class="section level3">
<h3 id="sales-note-data-before-2005">Sales note data before 2005<a class="anchor" aria-label="anchor" href="#sales-note-data-before-2005"></a>
</h3>
<p>Sales note data before 2005, compiled by Hans Stockhausen, are stored as Excel sheets on IMR servers. If you work in Bergen, you can read these files directly from the server with the <code><a href="../reference/readSluttseddelXLS.html">readSluttseddelXLS()</a></code> function. In contrast, users in Tromsø may find it easier to copy the relevant folders (“sluttseddel_xls_ferdige_År”) to their own hard disk due to slow server access. Remember, these data are not confidential, unlike ERS data for vessels under 15 meters.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to Stockhausen's sluttseddel Excel files to access data before 2005. </span></span>
<span><span class="co"># If you want to use the server, check his emails for the correct path</span></span>
<span><span class="va">sluttseddel_excel_path</span> <span class="op">&lt;-</span> <span class="st">".../sluttseddel/sluttseddel_XLS_ferdige_År"</span></span>
<span></span>
<span><span class="va">salesnote_xls_data</span> <span class="op">&lt;-</span> <span class="fu">RstoxUtils</span><span class="fu">::</span><span class="fu"><a href="../reference/readSluttseddelXLS.html">readSluttseddelXLS</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="st">"Snabeluer"</span>,</span>
<span>  dataDir <span class="op">=</span> <span class="va">sluttseddel_excel_path</span><span class="op">)</span></span></code></pre></div>
<p>The lines representing estimated catches overlap demonstrating that the results from these two data sources are almost identical (Figure <a href="#fig:fig-annual-landings-with-old-data">4</a>). <code><a href="../reference/readSluttseddelXLS.html">readSluttseddelXLS()</a></code> does not include the latest years because the Excel sheets were a mess at time of writing, but it is possible to try opening them by adjusting the <code>years</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salesnote_example_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">main_area</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">18</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">27</span>, <span class="fl">30</span>, <span class="fl">34</span><span class="op">:</span><span class="fl">39</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>    <span class="va">nation</span> <span class="op">==</span> <span class="st">"NOR"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="st">"API"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>    <span class="va">salesnote_xls_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">main_area</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">18</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">27</span>, <span class="fl">30</span>, <span class="fl">34</span><span class="op">:</span><span class="fl">39</span>, <span class="fl">50</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">reframe</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="st">"Excel"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Catch (kt)"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Source"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-annual-landings-with-old-data"></span>
<img src="LandingsData_files/figure-html/fig-annual-landings-with-old-data-1.png" alt="Annual beaked redfish landings by the Norwegian fleet within ICES areas 1 and 2 according to the sales note data acquired using downloadLandings and readSluttseddelXLS." width="864"><p class="caption">
Figure 4: Annual beaked redfish landings by the Norwegian fleet within ICES areas 1 and 2 according to the sales note data acquired using downloadLandings and readSluttseddelXLS.
</p>
</div>
</div>
<div class="section level3">
<h3 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h3>
<p>The <code><a href="../reference/downloadLandings.html">downloadLandings()</a></code> function may sometimes return something like:</p>
<blockquote>
<p>Error in downloadLandings(“Uer (vanlig)”) :
Species code 2202 with years not found from the database.</p>
</blockquote>
<p>Even if it worked previously and there is an access to the server. This happens likely (but not confirmed) due to unstable connection to the institute’s intranet (at least in Tromsø). If you are certain that the species exists and you have a connection to the intranet, try running the command again. If it still does not work, try splitting the request to smaller pieces using the years argument.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mikko Vihtakari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
